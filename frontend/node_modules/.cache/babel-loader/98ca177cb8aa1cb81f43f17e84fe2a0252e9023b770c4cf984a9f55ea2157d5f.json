{"ast":null,"code":"import React,{createContext,useState,useEffect,useCallback}from'react';import axios from'axios';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[notifications,setNotifications]=useState([]);const[socket,setSocket]=useState(null);const fetchNotifications=async()=>{try{const res=await axios.get('/api/notifications');setNotifications(res.data);}catch(e){console.error('Failed to fetch notifications',e);}};const setupSocket=()=>{const newSocket=io('http://localhost:5000');newSocket.on('notification',notification=>{setNotifications(prev=>[notification,...prev]);});setSocket(newSocket);};const fetchUser=useCallback(async()=>{try{const res=await axios.get('/api/auth/me');setUser(res.data);if(res.data){fetchNotifications();setupSocket();}}catch(e){localStorage.removeItem('token');delete axios.defaults.headers.common['Authorization'];}setLoading(false);},[]);useEffect(()=>{const token=localStorage.getItem('token');if(token){axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);fetchUser();}else{setLoading(false);}},[fetchUser]);const isAdmin=()=>(user===null||user===void 0?void 0:user.role)==='admin';const login=async(email,password)=>{const res=await axios.post('/api/auth/login',{email,password});const{token,user}=res.data;localStorage.setItem('token',token);axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(user);fetchNotifications();setupSocket();};const register=async(name,email,password)=>{const res=await axios.post('/api/auth/register',{name,email,password});const{token,user}=res.data;localStorage.setItem('token',token);axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(user);fetchNotifications();setupSocket();};const logout=()=>{localStorage.removeItem('token');delete axios.defaults.headers.common['Authorization'];setUser(null);setNotifications([]);socket===null||socket===void 0?void 0:socket.disconnect();setSocket(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,login,register,logout,loading,isAdmin,notifications,fetchNotifications},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","axios","io","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","notifications","setNotifications","socket","setSocket","fetchNotifications","res","get","data","e","console","error","setupSocket","newSocket","on","notification","prev","fetchUser","localStorage","removeItem","defaults","headers","common","token","getItem","concat","isAdmin","role","login","email","password","post","setItem","register","name","logout","disconnect","Provider","value"],"sources":["C:/Users/prera/Downloads/MOVIE REVIEW/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\r\nimport axios from 'axios';\r\nimport io from 'socket.io-client';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [socket, setSocket] = useState(null);\r\n\r\n  const fetchNotifications = async () => {\r\n    try {\r\n      const res = await axios.get('/api/notifications');\r\n      setNotifications(res.data);\r\n    } catch (e) {\r\n      console.error('Failed to fetch notifications', e);\r\n    }\r\n  };\r\n\r\n  const setupSocket = () => {\r\n    const newSocket = io('http://localhost:5000');\r\n    newSocket.on('notification', (notification) => {\r\n      setNotifications(prev => [notification, ...prev]);\r\n    });\r\n    setSocket(newSocket);\r\n  };\r\n\r\n  const fetchUser = useCallback(async () => {\r\n    try {\r\n      const res = await axios.get('/api/auth/me');\r\n      setUser(res.data);\r\n      if (res.data) {\r\n        fetchNotifications();\r\n        setupSocket();\r\n      }\r\n    } catch (e) {\r\n      localStorage.removeItem('token');\r\n      delete axios.defaults.headers.common['Authorization'];\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      fetchUser();\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, [fetchUser]);\r\n\r\n  const isAdmin = () => user?.role === 'admin';\r\n\r\n  const login = async (email, password) => {\r\n    const res = await axios.post('/api/auth/login', { email, password });\r\n    const { token, user } = res.data;\r\n    localStorage.setItem('token', token);\r\n    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n    setUser(user);\r\n    fetchNotifications();\r\n    setupSocket();\r\n  };\r\n\r\n  const register = async (name, email, password) => {\r\n    const res = await axios.post('/api/auth/register', { name, email, password });\r\n    const { token, user } = res.data;\r\n    localStorage.setItem('token', token);\r\n    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n    setUser(user);\r\n    fetchNotifications();\r\n    setupSocket();\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    delete axios.defaults.headers.common['Authorization'];\r\n    setUser(null);\r\n    setNotifications([]);\r\n    socket?.disconnect();\r\n    setSocket(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      user,\r\n      login,\r\n      register,\r\n      logout,\r\n      loading,\r\n      isAdmin,\r\n      notifications,\r\n      fetchNotifications\r\n    }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}